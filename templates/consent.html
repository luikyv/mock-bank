<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
      <title>Consent â€“ MockBank</title>
      <style>
         * { box-sizing: border-box; }
         body { margin: 0; font-family: sans-serif; background: #f9fafb; display: flex; align-items: center; justify-content: center; height: 100vh; color: #111827; }
         .container { background: #fff; padding: 2rem; border-radius: .75rem; box-shadow: 0 10px 25px rgba(0,0,0,.08); max-width: 540px; width: 100%; }
         h1, h2 { text-align: center; margin: 0; }
         h1 { font-size: 1.5rem; }
         h2 { font-size: 1.125rem; color: #4b5563; margin-bottom: 1rem; font-weight: normal; }
         .description { text-align: center; color: #6b7280; font-size: .95rem; margin-bottom: 1.25rem; }
         .info-block { background: #f3f4f6; color: #374151; padding: .5rem .75rem; border-radius: .375rem; font-size: .9rem; margin-bottom: 1rem; }
         .section { margin-top: 1.5rem 0 2rem; }
         .section-header { display: flex; justify-content: space-between; align-items: center; padding-bottom: .25rem; border-bottom: 1px solid #e5e7eb; cursor: pointer; }
         .section-header h3 { margin: 0; font-size: 1rem; }
         ul.accounts-list { list-style: none; padding: .5rem; margin: .5rem 0 1rem; border: 1px solid #e5e7eb; border-radius: .5rem; max-height: 160px; overflow-y: auto; display: none; }
         ul.accounts-list.show { display: block; }
         li + li { margin-top: .5rem; }
         label.checkbox { display: flex; align-items: center; gap: .5rem; font-size: .95rem; cursor: pointer; }
         button { width: 100%; padding: .75rem; font-size: 1rem; font-weight: 500; border: none; border-radius: .375rem; cursor: pointer; transition: background .2s; }
         .consent-button { background: #2563eb; color: #fff; margin-bottom: .75rem; }
         .consent-button:hover { background: #1e40af; }
         .cancel-button { background: #e5e7eb; color: #374151; }
         .cancel-button:hover { background: #d1d5db; }
      </style>
   </head>
   <body>
      <div class="container">
         <h1>MockBank</h1>
         <h2>Data Sharing Consent</h2>
         <p class="description">
            You are about to share your information with a trusted third party.
            Please review and confirm your choices.
         </p>
         {{ if .BusinessCNPJ }}
         <div class="info-block">
            <strong>Company (CNPJ):</strong> {{ .BusinessCNPJ }}
         </div>
         {{ end }}
         <form action="{{ .BaseURL }}/authorize/{{ .CallbackID }}" method="POST">
            {{ if .Accounts }}
            <div class="section">
               <div class="section-header" onclick="toggleAccountList()">
                  <h3>Accounts</h3>
                  <label class="checkbox" onclick="event.stopPropagation()">
                  <input
                     type="checkbox"
                     id="accountsToggle"
                     checked
                     onclick="event.stopPropagation(); toggleAllAccounts()"
                     />
                  Enable All
                  </label>
               </div>
               <ul id="accountsList" class="accounts-list">
                  {{ range .Accounts }}
                  <li>
                     <label class="checkbox">
                     <input
                        type="checkbox"
                        name="accounts"
                        value="{{ .ID }}"
                        checked
                        class="account-checkbox"
                        onchange="updateAccountsToggle()"
                        />
                     Branch: 0001, Number: {{ .Number }}
                     </label>
                  </li>
                  {{ end }}
               </ul>
            </div>
            {{ end }}
            <input type="hidden" name="consent" value="true" />
            <button type="submit" class="consent-button">Consent and Continue</button>
         </form>
         <form action="{{ .BaseURL }}/authorize/{{ .CallbackID }}" method="POST">
            <input type="hidden" name="consent" value="false" />
            <button type="submit" class="cancel-button">Deny</button>
         </form>
      </div>
      <script>
         function toggleAccountList() {
           document.getElementById('accountsList').classList.toggle('show');
         }
         
         function toggleAllAccounts() {
           const master = document.getElementById('accountsToggle');
           const boxes = document.querySelectorAll('.account-checkbox');
           boxes.forEach(cb => cb.checked = master.checked);
           master.indeterminate = false;
         }
         
         function updateAccountsToggle() {
           const master = document.getElementById('accountsToggle');
           const boxes = Array.from(document.querySelectorAll('.account-checkbox'));
           const all = boxes.every(cb => cb.checked);
           const none = boxes.every(cb => !cb.checked);
           master.checked = all;
           master.indeterminate = !all && !none;
         }
         
         document.addEventListener('DOMContentLoaded', updateAccountsToggle);
      </script>
   </body>
</html>